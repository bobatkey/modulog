(jbuild_version 1)

(library
 ((name modulog)
  (public_name modulog)
  (libraries (modules datalog fmt menhirLib))
  (flags (:standard -w -49+44 -safe-string))))
; (menhir
;  ((merge_into parser)
;   (modules (datalog_grammar modules_grammar))))

(rule
 ((targets (parser.ml parser.mli))
  (deps    (datalog_grammar.mly parser.messages))
  (action  (chdir ${ROOT}
            (run ${bin:menhir} --table
                               --base modulog/parser
                               ${<}
                               ${lib:modules:modules_grammar.mly})))))

(rule
 ((targets (parser_messages.ml))
  (deps    (datalog_grammar.mly parser.messages))
  (action  (chdir ${ROOT}
            (with-stdout-to modulog/parser_messages.ml
             (run ${bin:menhir} --table
                                --base modulog/parser
                                ${<}
                                ${lib:modules:modules_grammar.mly}
                                --compile-errors modulog/parser.messages))))))


(ocamllex
 (lexer))
